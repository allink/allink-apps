{% load cms_tags sekizai_tags i18n thumbnail %}

{% comment %}

    Map Config

{% endcomment %}

{# A map only makes sense, when locations are assigned #}
{% if object_list %}

    <div class="map-container">

        <div class="locations-map" id="map-{{instance.id}}" data-zoom-level="{{instance.zoom_level}}"></div>

        <script type="text/javascript">

            // init map array if hasn't already been set
            if(!window.MAPS) {
                window.MAPS = [];
            }

            var map_locations = {
                id: {{instance.id}},
                locations: {
                    // loop through locations
                    {% for object in object_list %}
                        // LAT and LNG are required
                        {% if object.lat or object.lng %}
                            {{forloop.counter}}: {
                                lat: '{{object.lat}}',
                                lng: '{{object.lng}}',
                                infowindow_content: '{% spaceless %}
                                <div class="map-info-box">
                                    <address>
                                        <div class="block">'
                                            {% if object.title %}
                                                + '<strong>{{object.title}}</strong><br>'
                                            {% endif %}
                                            {% if object.street %}
                                                + '{{object.street}}<br>'
                                            {% endif %}
                                            {% if object.zip_code or object.place %}
                                                + '{{object.zip_code}} {{object.place}}<br>'
                                            {% endif %}
                                        + '</div>'
                                        + '<div class="block">'
                                            {% if object.phone %}
                                                + 'T <a href="tel:{{object.phone}}">{{object.phone_formatted}}</a><br>'
                                            {% endif %}
                                            {% if object.mobile %}
                                                + 'M <a href="tel:{{object.mobile}}">{{object.mobile_formatted}}</a><br>'
                                            {% endif %}
                                            {% if object.fax %}
                                                + 'F <a href="tel:{{object.fax}}">{{object.fax_formatted}}</a><br>'
                                            {% endif %}
                                            {% if object.email %}
                                                + 'E <a href="mailto:{{object.email}}">{{object.email}}</a><br>'
                                            {% endif %}
                                        + '</div>'
                                    + '</address>
                                </div>
                                {% endspaceless %}',
                            },
                        {% endif %}
                    {% endfor %}
                }
            }

            // add map to array
            window.MAPS.push(map_locations);

        </script>

    </div>

{% endif %}
